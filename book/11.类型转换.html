<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ç±»å‹è½¬æ¢ - pybind11 Chinese docs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="00.ä»‹ç».html">ç®€ä»‹</a></li><li class="chapter-item expanded "><a href="01.æ”¹åŠ¨æ—¥å¿—.html"><strong aria-hidden="true">1.</strong> æ”¹åŠ¨æ—¥å¿—</a></li><li class="chapter-item expanded "><a href="02.æ›´æ–°æŒ‡å—.html"><strong aria-hidden="true">2.</strong> æ›´æ–°æŒ‡å—</a></li><li class="chapter-item expanded "><a href="03.å®‰è£…è¯´æ˜.html"><strong aria-hidden="true">3.</strong> å®‰è£…è¯´æ˜</a></li><li class="chapter-item expanded "><a href="04.é¦–æ¬¡å°è¯•.html"><strong aria-hidden="true">4.</strong> é¦–æ¬¡å°è¯•</a></li><li class="chapter-item expanded "><a href="05.é¢å¯¹å¯¹è±¡ç¼–ç¨‹.html"><strong aria-hidden="true">5.</strong> é¢å¯¹å¯¹è±¡ç¼–ç¨‹</a></li><li class="chapter-item expanded "><a href="06.æ„å»ºç³»ç»Ÿ.html"><strong aria-hidden="true">6.</strong> æ„å»ºç³»ç»Ÿ</a></li><li class="chapter-item expanded "><a href="07.å‡½æ•°.html"><strong aria-hidden="true">7.</strong> å‡½æ•°</a></li><li class="chapter-item expanded "><a href="08.ç±».html"><strong aria-hidden="true">8.</strong> ç±»</a></li><li class="chapter-item expanded "><a href="09.å¼‚å¸¸.html"><strong aria-hidden="true">9.</strong> å¼‚å¸¸</a></li><li class="chapter-item expanded "><a href="10.æ™ºèƒ½æŒ‡é’ˆ.html"><strong aria-hidden="true">10.</strong> æ™ºèƒ½æŒ‡é’ˆ</a></li><li class="chapter-item expanded "><a href="11.ç±»å‹è½¬æ¢.html" class="active"><strong aria-hidden="true">11.</strong> ç±»å‹è½¬æ¢</a></li><li class="chapter-item expanded "><a href="12.Pythonçš„C++æ¥å£.html"><strong aria-hidden="true">12.</strong> Pythonçš„C++æ¥å£</a></li><li class="chapter-item expanded "><a href="13.å†…åµŒè§£é‡Šå™¨.html"><strong aria-hidden="true">13.</strong> å†…åµŒè§£é‡Šå™¨</a></li><li class="chapter-item expanded "><a href="14.æ‚é¡¹.html"><strong aria-hidden="true">14.</strong> æ‚é¡¹</a></li><li class="chapter-item expanded "><a href="15.FAQ.html"><strong aria-hidden="true">15.</strong> FAQ</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">pybind11 Chinese docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="11-ç±»å‹è½¬æ¢"><a class="header" href="#11-ç±»å‹è½¬æ¢">11. ç±»å‹è½¬æ¢</a></h2>
<p>é™¤äº†æ”¯æŒè·¨è¯­è¨€å‡½æ•°è°ƒç”¨ï¼Œpybind11è¿™ç±»ç»‘å®šå·¥å…·å¿…é¡»å¤„ç†çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜å°±æ˜¯ï¼Œæä¾›åœ¨C++ä¸­è®¿é—®åŸç”ŸPythonç±»å‹çš„æ–¹å¼ï¼Œåä¹‹äº¦ç„¶ã€‚æœ‰ä¸‰ç§å®Œå…¨ä¸åŒçš„æ–¹æ³•åšåˆ°è¿™ç‚¹ï¼Œæ¯ç§æ–¹æ³•é€‚ç”¨æ€§å–å†³äºä½ ä½¿ç”¨çš„ç¯å¢ƒã€‚</p>
<ol>
<li>ä»»æ„ä¾§ä½¿ç”¨åŸç”Ÿçš„C++ç±»å‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»ä½¿ç”¨pybind11ç”Ÿæˆç±»å‹çš„ç»‘å®šï¼ŒPythonæ‰èƒ½ä½¿ç”¨å®ƒã€‚</li>
<li>ä»»æ„ä¾§ä½¿ç”¨åŸç”Ÿçš„Pythonç±»å‹ã€‚åŒæ ·éœ€è¦åŒ…è£…åï¼ŒC++å‡½æ•°æ‰èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚</li>
<li>C++ä¾§ä½¿ç”¨åŸç”ŸC++ç±»å‹ï¼ŒPythonä¾§ä½¿ç”¨åŸç”ŸPythonç±»å‹ã€‚pybind11ç§°å…¶ä¸ºç±»å‹è½¬æ¢ã€‚
æŸç§æ„ä¹‰ä¸‹ï¼Œåœ¨ä»»æ„ä¾§ä½¿ç”¨åŸç”Ÿç±»å‹ï¼Œç±»å‹è½¬æ¢æ˜¯æœ€è‡ªç„¶çš„é€‰é¡¹ã€‚è¯¥æ–¹æ³•ä¸»è¦çš„ç¼ºç‚¹æ˜¯ï¼Œæ¯æ¬¡Pythonå’ŒC++ä¹‹é—´è½¬æ¢æ—¶éƒ½éœ€è¦æ‹·è´ä¸€ä»½æ•°æ®ï¼Œå› ä¸ºC++å’ŒPythonçš„å¯¹ç›¸åŒç±»å‹çš„å†…å­˜å¸ƒå±€ä¸ä¸€æ ·ã€‚
pybind11å¯ä»¥è‡ªåŠ¨å®Œæˆå¤šç§ç±»å‹çš„è½¬æ¢ã€‚åé¢ä¼šæä¾›æ‰€æœ‰å†…ç½®è½¬æ¢çš„è¡¨æ ¼ã€‚</li>
</ol>
<p>ä¸‹é¢çš„å°èŠ‚å°†æ›´è¯¦ç»†åœ°è®¨è®ºè¿™äº›é€‰é¡¹ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<h3 id="111-æ¦‚è¿°"><a class="header" href="#111-æ¦‚è¿°">11.1 æ¦‚è¿°</a></h3>
<p><strong>1. Native type in C++, wrapper in Python</strong></p>
<p>åœ¨â€œé¢å¯¹å¯¹è±¡ç¼–ç¨‹â€ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†é€šè¿‡<code>py::class_</code>å…¬å¼€è‡ªå®šä¹‰C++ç±»å‹çš„æ–¹æ³•ã€‚è¿™é‡Œï¼Œåº•å±‚çš„æ•°æ®ç»“æ„ä»ç„¶æ˜¯åŸå§‹çš„C++ç±»ï¼Œè€Œ<code>py::class_</code>åŒ…è£…åˆ™æä¾›äº†Pythonä¾§çš„æ¥å£ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä»C++ä¾§å‘é€åˆ°Pythonä¾§æ—¶ï¼Œpybind11ä»…ä»…åœ¨åŸå§‹çš„C++å¯¹è±¡ä¸Šå¢åŠ äº†ä¸€å±‚åŒ…è£…è€Œå·²ã€‚ä»Pythonä¾§è·å–å®ƒä¹Ÿä»…ä»…æ˜¯æ’•æ‰äº†åŒ…è£…è€Œå·²ã€‚</p>
<p><strong>2. Wrapper in C++, native type in Python</strong></p>
<p>è¿™ä¸ä¸Šé¢æ˜¯å®Œå…¨ç›¸åçš„æƒ…å†µã€‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªåŸç”Ÿçš„Pythonç±»å‹ï¼Œå¦‚tupleæˆ–listã€‚åœ¨C++ä¾§è·å–è¿™ä¸ªæ•°æ®çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<code>py::object</code>æ—åŒ…è£…å™¨ã€‚è¿™å°†åœ¨åç»­ç« èŠ‚è¯¦ç»†è§£é‡Šã€‚è¿™é‡Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code class="language-c++">void print_list(py::list my_list) {
    for (auto item : my_list)
        std::cout &lt;&lt; item &lt;&lt; &quot; &quot;;
}
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; print_list([1, 2, 3])
1 2 3
</code></pre>
<p>Pythonçš„listä»…ä»…æ˜¯åŒ…è£¹åœ¨äº†C++ <code>py::list</code>ç±»é‡Œï¼Œå¹¶æ²¡æœ‰ä»…ä»…ä»»ä½•è½¬æ¢ã€‚å®ƒçš„æ ¸å¿ƒä»»ç„¶æ˜¯ä¸€ä¸ªPythonå¯¹è±¡ã€‚æ‹·è´ä¸€ä¸ª<code>py::list</code>ä¼šåƒPythonä¸­ä¸€æ ·å¢åŠ å¼•ç”¨è®¡æ•°ã€‚å°†å¯¹è±¡è¿”å›åˆ°Pythonä¾§ï¼Œå°†å»æ‰è¿™å±‚å°è£…ã€‚</p>
<p><strong>3. Converting between native C++ and Python types</strong></p>
<p>å‰é¢ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨ä¸€ç§è¯­è¨€ä¸­ä½¿ç”¨åŸç”Ÿç±»å‹ï¼Œè€Œåœ¨å¦ä¸€ç§è¯­è¨€ä¸­ä½¿ç”¨å®ƒçš„åŒ…è£…ç±»å‹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¾§éƒ½ä½¿ç”¨åŸç”Ÿç±»å‹ï¼Œå¹¶å¯¹ä»–ä»¬è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p>
<pre><code class="language-c++">void print_vector(const std::vector&lt;int&gt; &amp;v) {
    for (auto item : v)
        std::cout &lt;&lt; item &lt;&lt; &quot;\n&quot;;
}
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; print_vector([1, 2, 3])
1 2 3
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œpybind11å°†åˆ›å»ºä¸€ä¸ª<code>std::vector&lt;int&gt;</code>å®ä¾‹ï¼Œå¹¶ä»Python listä¸­æ‹·è´æ¯ä¸ªå…ƒç´ ã€‚ç„¶åå°†è¯¥å®ä¾‹ä¼ é€’ç»™<code>print_vector</code>ã€‚åŒæ ·çš„äº‹æƒ…å‘ç”Ÿåœ¨å¦ä¸€ä¸ªæ–¹å‘ï¼šæ–°å»ºäº†ä¸€ä¸ªlistï¼Œå¹¶ä»C++çš„vectorä¸­è·å–å…ƒç´ å€¼ã€‚</p>
<p>å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œå¤šæ•°è½¬æ¢æ˜¯å¼€ç®±å³ç”¨çš„ã€‚ä»–ä»¬ç›¸å½“æ–¹ä¾¿ï¼Œä½†è¯·è®°ä½ä¸€ç‚¹ï¼Œè¿™äº›è½¬æ¢æ˜¯åŸºäºæ•°æ®æ‹·è´çš„ã€‚è¿™å¯¹å°å‹çš„ä¸å˜çš„ç±»å‹ç›¸å½“å‹å¥½ï¼Œå¯¹äºå¤§å‹æ•°æ®ç»“æ„åˆ™ç›¸å½“æ˜‚è´µã€‚è¿™å¯ä»¥é€šè¿‡è‡ªå®šä¹‰åŒ…è£…ç±»å‹é‡è½½è‡ªåŠ¨è½¬æ¢æ¥è§„é¿ï¼ˆå¦‚ä¸Šé¢æåˆ°çš„æ–¹æ³•1ï¼‰ã€‚This requires some manual effort and more details are available in the <a href="https://pybind11.readthedocs.io/en/stable/advanced/cast/stl.html#opaque">Making opaque types</a> section.</p>
<p><strong>å†…ç½®è½¬æ¢çš„åˆ—è¡¨</strong></p>
<p>ä¸‹é¢åŸºç¡€æ•°æ®ç±»å‹æ˜¯å¼€ç®±å³ç”¨çš„ï¼ˆæœ‰äº›å¯èƒ½éœ€è¦includeé¢å¤–çš„å¤´æ–‡ä»¶ï¼‰ã€‚</p>
<div class="table-wrapper"><table><thead><tr><th>Data type</th><th>Description</th><th>Header file</th></tr></thead><tbody>
<tr><td><code>int8_t</code>, <code>uint8_t</code></td><td>8-bit integers</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>int16_t</code>, <code>uint16_t</code></td><td>16-bit integers</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>int32_t</code>, <code>uint32_t</code></td><td>32-bit integers</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>int64_t</code>, <code>uint64_t</code></td><td>64-bit integers</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>ssize_t</code>, <code>size_t</code></td><td>Platform-dependent size</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>float</code>, <code>double</code></td><td>Floating point types</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>bool</code></td><td>Two-state Boolean type</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>char</code></td><td>Character literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>char16_t</code></td><td>UTF-16 character literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>char32_t</code></td><td>UTF-32 character literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>wchar_t</code></td><td>Wide character literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>const char *</code></td><td>UTF-8 string literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>const char16_t *</code></td><td>UTF-16 string literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>const char32_t *</code></td><td>UTF-32 string literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>const wchar_t *</code></td><td>Wide string literal</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::string</code></td><td>STL dynamic UTF-8 string</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::u16string</code></td><td>STL dynamic UTF-16 string</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::u32string</code></td><td>STL dynamic UTF-32 string</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::wstring</code></td><td>STL dynamic wide string</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::string_view</code>, <code>std::u16string_view</code>, etc.</td><td>STL C++17 string views</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::pair&lt;T1, T2&gt;</code></td><td>Pair of two custom types</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::tuple&lt;...&gt;</code></td><td>Arbitrary tuple of types</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::reference_wrapper&lt;...&gt;</code></td><td>Reference type wrapper</td><td><code>pybind11/pybind11.h</code></td></tr>
<tr><td><code>std::complex&lt;T&gt;</code></td><td>Complex numbers</td><td><code>pybind11/complex.h</code></td></tr>
<tr><td><code>std::array&lt;T, Size&gt;</code></td><td>STL static array</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::vector&lt;T&gt;</code></td><td>STL dynamic array</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::deque&lt;T&gt;</code></td><td>STL double-ended queue</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::valarray&lt;T&gt;</code></td><td>STL value array</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::list&lt;T&gt;</code></td><td>STL linked list</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::map&lt;T1, T2&gt;</code></td><td>STL ordered map</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::unordered_map&lt;T1, T2&gt;</code></td><td>STL unordered map</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::set&lt;T&gt;</code></td><td>STL ordered set</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::unordered_set&lt;T&gt;</code></td><td>STL unordered set</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::optional&lt;T&gt;</code></td><td>STL optional type (C++17)</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::experimental::optional&lt;T&gt;</code></td><td>STL optional type (exp.)</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::variant&lt;...&gt;</code></td><td>Type-safe union (C++17)</td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::filesystem::path&lt;T&gt;</code></td><td>STL path (C++17) <a href="https://pybind11.readthedocs.io/en/stable/advanced/cast/overview.html#id2">1</a></td><td><code>pybind11/stl.h</code></td></tr>
<tr><td><code>std::function&lt;...&gt;</code></td><td>STL polymorphic function</td><td><code>pybind11/functional.h</code></td></tr>
<tr><td><code>std::chrono::duration&lt;...&gt;</code></td><td>STL time duration</td><td><code>pybind11/chrono.h</code></td></tr>
<tr><td><code>std::chrono::time_point&lt;...&gt;</code></td><td>STL date/time</td><td><code>pybind11/chrono.h</code></td></tr>
<tr><td><code>Eigen::Matrix&lt;...&gt;</code></td><td>Eigen: dense matrix</td><td><code>pybind11/eigen.h</code></td></tr>
<tr><td><code>Eigen::Map&lt;...&gt;</code></td><td>Eigen: mapped memory</td><td><code>pybind11/eigen.h</code></td></tr>
<tr><td><code>Eigen::SparseMatrix&lt;...&gt;</code></td><td>Eigen: sparse matrix</td><td><code>pybind11/eigen.h</code></td></tr>
</tbody></table>
</div>
<h3 id="112-strings-bytes-and-unicode-conversions"><a class="header" href="#112-strings-bytes-and-unicode-conversions">11.2 Strings, bytes and Unicode conversions</a></h3>
<blockquote>
<p>Note: æœ¬èŠ‚è®¨è®ºçš„stringå¤„ç†åŸºäºPython3 stringsã€‚å¯¹äºpython2.7ï¼Œä½¿ç”¨<code>unicode</code>æ›¿æ¢<code>str</code>ï¼Œ<code>str</code>æ›¿æ¢<code>bytes</code>ã€‚Python2.7ç”¨äºæœ€å¥½ä½¿ç”¨<code>from __future__ import unicode_literals</code>é¿å…æ— æ„é—´ä½¿ç”¨<code>str</code>ä»£æ›¿<code>unicode</code>ã€‚</p>
</blockquote>
<h4 id="1121-ä¼ é€’python-stringsåˆ°c"><a class="header" href="#1121-ä¼ é€’python-stringsåˆ°c">11.2.1 ä¼ é€’Python stringsåˆ°C++</a></h4>
<p>å½“å‘ä¸€ä¸ªæ¥æ”¶<code>std::string</code>æˆ–<code>char *</code>å‚æ•°çš„å‡½æ•°ä¼ é€’Pythonçš„<code>str</code>æ—¶ï¼Œpybind11ä¼šå°†Pythonå­—ç¬¦ä¸²ç¼–ç ä¸ºUTF-8ã€‚æ‰€æœ‰çš„Python <code>str</code>éƒ½èƒ½å¤Ÿç”¨UTF-8ç¼–ç ï¼Œæ‰€ä»¥è¿™ä¸ªæ“ä½œä¸ä¼šå¤±è´¥ã€‚</p>
<p>C++è¯­è¨€æ˜¯encoding agnosticã€‚ç¨‹åºå‘˜è´Ÿè´£å¤„ç†ç¼–ç ï¼Œæœ€ç®€å•çš„åšæ³•å°±æ˜¯æ¯å¤„éƒ½ä½¿ç”¨UTF-8ã€‚</p>
<pre><code class="language-c++">m.def(&quot;utf8_test&quot;,
    [](const std::string &amp;s) {
        cout &lt;&lt; &quot;utf-8 is icing on the cake.\n&quot;;
        cout &lt;&lt; s;
    }
);
m.def(&quot;utf8_charptr&quot;,
    [](const char *s) {
        cout &lt;&lt; &quot;My favorite food is\n&quot;;
        cout &lt;&lt; s;
    }
);
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; utf8_test(&quot;ğŸ‚&quot;)
utf-8 is icing on the cake.
ğŸ‚

&gt;&gt;&gt; utf8_charptr(&quot;ğŸ•&quot;)
My favorite food is
ğŸ•
</code></pre>
<blockquote>
<p>Note: æœ‰äº›ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒUTF-8æˆ–emojiå­—ä½“ï¼Œä¸Šé¢çš„ä¾‹å­å¯èƒ½æ— æ³•æ˜¾ç¤ºã€‚</p>
</blockquote>
<p>æ— è®ºC++å‡½æ•°çš„å‚æ•°æ˜¯ä¼ å€¼æˆ–å¼•ç”¨ï¼Œæ˜¯å¦æ˜¯constï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p><strong>å‘C++ä¼ é€’byteså¯¹è±¡</strong></p>
<p>å‘æ¥æ”¶<code>std::string</code>æˆ–<code>char *</code>ç±»å‹å‚æ•°çš„C++å‡½æ•°ä¼ é€’Python byteså¯¹è±¡æ— éœ€è½¬æ¢ã€‚åœ¨Python3ä¸Šï¼Œå¦‚æœæƒ³è¦å‡½æ•°åªæ¥æ”¶bytesï¼Œä¸æ¥æ”¶strï¼Œå¯ä»¥å£°æ˜å‚æ•°ç±»å‹ä¸º<code>py::bytes</code>ã€‚</p>
<h4 id="1122-å‘pythonè¿”å›c-å­—ç¬¦ä¸²"><a class="header" href="#1122-å‘pythonè¿”å›c-å­—ç¬¦ä¸²">11.2.2 å‘Pythonè¿”å›C++ å­—ç¬¦ä¸²</a></h4>
<p>å½“C++å‡½æ•°è¿”å›<code>std::string</code>æˆ–<code>char*</code>å‚æ•°ç»™Pythonè°ƒç”¨è€…æ—¶ï¼Œpybind11ä¼šå°†å­—ç¬¦ä¸²ä»¥UTF-8æ ¼å¼è§£ç ç»™åŸç”ŸPython strï¼Œç±»ä¼¼äºPythonä¸­çš„<code>bytes.decode('utf-8')</code>ã€‚å¦‚æœéšå¼è½¬æ¢å¤±è´¥ï¼Œpybind11å°†ä¼šæŠ›å‡ºå¼‚å¸¸<code>UnicodeDecodeError</code>ã€‚</p>
<pre><code class="language-c++">m.def(&quot;std_string_return&quot;,
    []() {
        return std::string(&quot;This string needs to be UTF-8 encoded&quot;);
    }
);
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; isinstance(example.std_string_return(), str)
True
</code></pre>
<p>å› ä¸ºUTF-8åŒ…å«çº¯ASCIIï¼Œè¿”å›ä¸€ä¸ªçº¯ASCIIå­—ç¬¦ä¸²åˆ°Pythonæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚å¦åˆ™å°±éœ€è¦ç¡®ä¿ç¼–ç æ˜¯æœ‰æ•ˆçš„UTF-8ã€‚</p>
<blockquote>
<p>Warning: éšå¼è½¬æ¢å‡å®š<code>char *</code>å­—ç¬¦ä¸²ä»¥nullä¸ºç»“æŸç¬¦ã€‚è‹¥ä¸æ˜¯ï¼Œå°†å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚</p>
</blockquote>
<p><strong>æ˜¾å¼è½¬æ¢</strong></p>
<p>å¦‚æœC++ä»£ç æ„é€ äº†ä¸€ä¸ªéUTF-8çš„stringå­—ç¬¦ä¸²ï¼Œå¯ä»¥æ‰§è¡Œæ˜¾å¼è½¬æ¢å¹¶è¿”å›<code>py::str</code>å¯¹è±¡ã€‚æ˜¾å¼è½¬æ¢ä¸éšå¼è½¬æ¢çš„å¼€é”€ç›¸åŒã€‚</p>
<pre><code class="language-c++">// This uses the Python C API to convert Latin-1 to Unicode
m.def(&quot;str_output&quot;,
    []() {
        std::string s = &quot;Send your r\xe9sum\xe9 to Alice in HR&quot;; // Latin-1
        py::str py_s = PyUnicode_DecodeLatin1(s.data(), s.length());
        return py_s;
    }
);
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; str_output()
'Send your rÃ©sumÃ© to Alice in HR'
</code></pre>
<p><a href="https://docs.python.org/3/c-api/unicode.html#built-in-codecs">Python C API</a>æä¾›äº†ä¸€äº›å†…ç½®çš„ç¼–è§£ç æ–¹æ³•å¯ä»¥ä½¿ç”¨ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚libiconv æ¥è½¬æ¢UTF-8ã€‚</p>
<p><strong>ä¸ä½¿ç”¨ç±»å‹è½¬æ¢æ¥è¿”å›C++å­—ç¬¦ä¸²</strong></p>
<p>å¦‚æœC++ <code>std::string</code>ä¸­çš„æ•°æ®ä¸è¡¨ç¤ºæ–‡æœ¬ï¼Œåˆ™åº”è¯¥ä»¥<code>bytes</code>çš„å½¢å¼ä¼ é€’ç»™Pythonï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥è¿”å›ä¸€ä¸ª<code>py::btyes</code>å¯¹è±¡ã€‚</p>
<pre><code class="language-c++">m.def(&quot;return_bytes&quot;,
    []() {
        std::string s(&quot;\xba\xd0\xba\xd0&quot;);  // Not valid UTF-8
        return py::bytes(s);  // Return the data without transcoding
    }
);
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; example.return_bytes()
b'\xba\xd0\xba\xd0'
</code></pre>
<p>æ³¨æ„ï¼špybind11å¯ä»¥å°†bytesæ— éœ€ç¼–ç åœ°è½¬æ¢ä¸º<code>std::string</code>ï¼Œä½†ä¸èƒ½ä¸ç»ç¼–ç åœ°éšå¼è½¬æ¢<code>std::string</code>åˆ°bytesã€‚</p>
<pre><code class="language-c++">m.def(&quot;asymmetry&quot;,
    [](std::string s) {  // Accepts str or bytes from Python
        return s;  // Looks harmless, but implicitly converts to str
    }
);
</code></pre>
<pre><code class="language-python">&gt;&gt;&gt; isinstance(example.asymmetry(b&quot;have some bytes&quot;), str)
True

&gt;&gt;&gt; example.asymmetry(b&quot;\xba\xd0\xba\xd0&quot;)  # invalid utf-8 as bytes
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xba in position 0: invalid start byte
</code></pre>
<h4 id="1123-å®½å­—ç¬¦ä¸²"><a class="header" href="#1123-å®½å­—ç¬¦ä¸²">11.2.3 å®½å­—ç¬¦ä¸²</a></h4>
<p>å‘å…¥å‚ä¸º<code>std::wstring</code>ã€<code>wchar_t*</code>ã€<code>std::u16string</code>æˆ–<code>std::u32string</code>çš„C++å‡½æ•°ä¼ é€’Python strå¯¹è±¡ï¼Œstrå°†è¢«ç¼–ç ä¸ºUTF-16æˆ–UTF-32ï¼ˆå…·ä½“å“ªç§å–å†³äºC++ç¼–è¯‘å™¨çš„æ”¯æŒï¼‰ã€‚å½“C++å‡½æ•°è¿”å›è¿™äº›ç±»å‹çš„å­—ç¬¦ä¸²åˆ°Python stræ—¶ï¼Œéœ€è¦ä¿è¯å­—ç¬¦ä¸²æ˜¯åˆæ³•çš„UTF-16æˆ–UTF-32ã€‚</p>
<pre><code class="language-c++">#define UNICODE
#include &lt;windows.h&gt;

m.def(&quot;set_window_text&quot;,
    [](HWND hwnd, std::wstring s) {
        // Call SetWindowText with null-terminated UTF-16 string
        ::SetWindowText(hwnd, s.c_str());
    }
);
m.def(&quot;get_window_text&quot;,
    [](HWND hwnd) {
        const int buffer_size = ::GetWindowTextLength(hwnd) + 1;
        auto buffer = std::make_unique&lt; wchar_t[] &gt;(buffer_size);

        ::GetWindowText(hwnd, buffer.data(), buffer_size);

        std::wstring text(buffer.get());

        // wstring will be converted to Python str
        return text;
    }
);
</code></pre>
<blockquote>
<p>è­¦å‘Šï¼šå¸¦<code>--enable-unicode=ucs2</code>é€‰é¡¹ç¼–è¯‘çš„Python 2.7å’Œ3.3ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒä¸Šè¿°çš„å®½å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>å¤šå­—èŠ‚ç¼–ç åœ°å­—ç¬¦ä¸²ï¼Œå¦‚Shift-JISï¼Œå¿…é¡»è½¬æ¢ä¸ºUTF-8/16/32åï¼Œå†è¿”å›ç»™Pythonã€‚</p>
<h4 id="1124-å­—ç¬¦ç±»å‹"><a class="header" href="#1124-å­—ç¬¦ç±»å‹">11.2.4 å­—ç¬¦ç±»å‹</a></h4>
<p>å‘ä¸€ä¸ªå…¥å‚ä¸ºå­—ç¬¦ç±»å‹ï¼ˆchar, wchar_tï¼‰çš„C++å‡½æ•°ï¼Œä¼ é€’Python strï¼ŒC++å‡½æ•°å°†æ¥æ”¶strçš„é¦–å­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸²è¶…è¿‡ä¸€ä¸ªUnicodeå­—ç¬¦é•¿åº¦ï¼Œå°†å¿½ç•¥å°¾éƒ¨å­—èŠ‚ã€‚</p>
<p>å½“C++è¿”å›ä¸€ä¸ªå­—ç¬¦å˜é‡æ—¶ï¼Œå®ƒå°†è¢«è½¬åŒ–ä¸ºå•å­—ç¬¦çš„strå˜é‡ã€‚</p>
<pre><code class="language-c++">m.def(&quot;pass_char&quot;, [](char c) { return c; });
m.def(&quot;pass_wchar&quot;, [](wchar_t w) { return w; });
</code></pre>
<pre><code class="language-python">example.pass_char(&quot;A&quot;)
'A'
</code></pre>
<p>è™½ç„¶C++å¯ä»¥å°†æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ç±»å‹ï¼ˆ<code>char c = 0x65</code>ï¼‰ï¼Œpybind11å¹¶ä¸ä¼šéšå¼è½¬æ¢Pythonæ•´æ•°åˆ°å­—ç¬¦ç±»å‹ã€‚å¯ä»¥ä½¿ç”¨<code>chr()</code>Pythonå‡½æ•°æ¥å°†æ•´æ•°è½¬æ¢ä¸ºå­—ç¬¦ã€‚</p>
<pre><code class="language-python">&gt;&gt;&gt; example.pass_char(0x65)
TypeError

&gt;&gt;&gt; example.pass_char(chr(0x65))
'A'
</code></pre>
<p>å¦‚æœéœ€è¦ä½¿ç”¨8-bitæ•´æ•°ï¼Œå¯ä½¿ç”¨<code>int8_t</code>æˆ–<code>uint8_t</code>ä½œä¸ºå‚æ•°ç±»å‹ã€‚</p>
<h4 id="1125-grapheme-clusters"><a class="header" href="#1125-grapheme-clusters">11.2.5 Grapheme clusters</a></h4>
<p>A single grapheme may be represented by two or more Unicode characters. For example â€˜Ã©â€™ is usually represented as U+00E9 but can also be expressed as the combining character sequence U+0065 U+0301 (that is, the letter â€˜eâ€™ followed by a combining acute accent). The combining character will be lost if the two-character sequence is passed as an argument, even though it renders as a single grapheme.</p>
<pre><code>&gt;&gt;&gt; example.pass_wchar(&quot;Ã©&quot;)
'Ã©'

&gt;&gt;&gt; combining_e_acute = &quot;e&quot; + &quot;\u0301&quot;

&gt;&gt;&gt; combining_e_acute
'eÌ'

&gt;&gt;&gt; combining_e_acute == &quot;Ã©&quot;
False

&gt;&gt;&gt; example.pass_wchar(combining_e_acute)
'e'
</code></pre>
<p>Normalizing combining characters before passing the character literal to C++ may resolve <em>some</em> of these issues:</p>
<pre><code>&gt;&gt;&gt; example.pass_wchar(unicodedata.normalize(&quot;NFC&quot;, combining_e_acute))
'Ã©'
</code></pre>
<p>In some languages (Thai for example), there are <a href="http://unicode.org/reports/tr29/#Grapheme_Cluster_Boundaries">graphemes that cannot be expressed as a single Unicode code point</a>, so there is no way to capture them in a C++ character type.</p>
<h4 id="1126-c17-string_view"><a class="header" href="#1126-c17-string_view">11.2.6 c++17 string_view</a></h4>
<p>C++17 string views are automatically supported when compiling in C++17 mode. They follow the same rules for encoding and decoding as the corresponding STL string type (for example, a <code>std::u16string_view</code> argument will be passed UTF-16-encoded data, and a returned <code>std::string_view</code> will be decoded as UTF-8).</p>
<h3 id="113-stlå®¹å™¨"><a class="header" href="#113-stlå®¹å™¨">11.3 STLå®¹å™¨</a></h3>
<h4 id="1131-è‡ªåŠ¨è½¬æ¢"><a class="header" href="#1131-è‡ªåŠ¨è½¬æ¢">11.3.1 è‡ªåŠ¨è½¬æ¢</a></h4>
<p>åŒ…å«å¤´æ–‡ä»¶<code>pybind11/stl.h</code>åï¼Œè‡ªåŠ¨æ”¯æŒ <code>std::vector&lt;&gt;</code>/<code>std::deque&lt;&gt;</code>/<code>std::list&lt;&gt;</code>/<code>std::array&lt;&gt;</code>/<code>std::valarray&lt;&gt;</code>, <code>std::set&lt;&gt;</code>/<code>std::unordered_set&lt;&gt;</code>, å’Œ<code>std::map&lt;&gt;</code>/<code>std::unordered_map&lt;&gt;</code> åˆ°Python <code>list</code>, <code>set</code> å’Œ <code>dict</code> çš„ç±»å‹è½¬æ¢ã€‚ <code>std::pair&lt;&gt;</code> å’Œ<code>std::tuple&lt;&gt;</code> ç±»å‹è½¬æ¢åœ¨<code>pybind11/pybind11.h</code>ä¸­å·²ç»æ”¯æŒã€‚</p>
<p>éšå¼è½¬æ¢çš„ä¸»è¦ç¼ºç‚¹å°±æ˜¯Pythonå’ŒC++ä¹‹é—´çš„å®¹å™¨ç±»å‹è½¬æ¢éƒ½éœ€è¦æ‹·è´æ•°æ®ï¼Œè¿™å¯¹ç¨‹åºè¯­ä¹‰å’Œæ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ã€‚åç»­ç« èŠ‚å°†ä»‹ç»å¦‚ä½•é¿å…è¯¥é—®é¢˜ã€‚</p>
<blockquote>
<p>Note: è¿™äº›ç±»å‹ä»»æ„åµŒå¥—éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
</blockquote>
<h4 id="1132-c17åº“çš„å®¹å™¨"><a class="header" href="#1132-c17åº“çš„å®¹å™¨">11.3.2 C++17åº“çš„å®¹å™¨</a></h4>
<p><code>pybind11/stl.h</code>æ”¯æŒC++17çš„ <code>std::optional&lt;&gt;</code> å’Œ<code>std::variant&lt;&gt;</code>ï¼ŒC++14çš„<code>std::experimental::optional&lt;&gt;</code>ã€‚</p>
<p>C++11ä¸­ä¹Ÿå­˜åœ¨è¿™äº›å®¹å™¨çš„å…¶ä»–ç‰ˆæœ¬ï¼Œå¦‚Boostä¸­ã€‚pybind11æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•<code>type_caster</code>æ¥å¤„ç†è¿™äº›ç±»å‹ï¼š</p>
<pre><code class="language-c++">// `boost::optional` as an example -- can be any `std::optional`-like container
namespace pybind11 { namespace detail {
    template &lt;typename T&gt;
    struct type_caster&lt;boost::optional&lt;T&gt;&gt; : optional_caster&lt;boost::optional&lt;T&gt;&gt; {};
}}
</code></pre>
<p>ä¸Šè¿°å†…å®¹åº”æ”¾åˆ°å¤´æ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹åŒ…å«å®ƒä»¬ã€‚Similarly, a specialization can be provided for custom variant types:</p>
<pre><code class="language-c++">// `boost::variant` as an example -- can be any `std::variant`-like container
namespace pybind11 { namespace detail {
    template &lt;typename... Ts&gt;
    struct type_caster&lt;boost::variant&lt;Ts...&gt;&gt; : variant_caster&lt;boost::variant&lt;Ts...&gt;&gt; {};

    // Specifies the function used to visit the variant -- `apply_visitor` instead of `visit`
    template &lt;&gt;
    struct visit_helper&lt;boost::variant&gt; {
        template &lt;typename... Args&gt;
        static auto call(Args &amp;&amp;...args) -&gt; decltype(boost::apply_visitor(args...)) {
            return boost::apply_visitor(args...);
        }
    };
}} // namespace pybind11::detail
</code></pre>
<p>The <code>visit_helper</code> specialization is not required if your <code>name::variant</code> provides a <code>name::visit()</code> function. For any other function name, the specialization must be included to tell pybind11 how to visit the variant.</p>
<blockquote>
<p>Warning: When converting a <code>variant</code> type, pybind11 follows the same rules as when determining which function overload to call (<a href="https://pybind11.readthedocs.io/en/stable/advanced/functions.html#overload-resolution">Overload resolution order</a>), and so the same caveats hold. In particular, the order in which the <code>variant</code>â€™s alternatives are listed is important, since pybind11 will try conversions in this order. This means that, for example, when converting <code>variant&lt;int, bool&gt;</code>, the <code>bool</code> variant will never be selected, as any Python <code>bool</code> is already an <code>int</code> and is convertible to a C++ <code>int</code>. Changing the order of alternatives (and using <code>variant&lt;bool, int&gt;</code>, in this example) provides a solution.</p>
</blockquote>
<h4 id="1133-åˆ¶ä½œopaqueç±»å‹"><a class="header" href="#1133-åˆ¶ä½œopaqueç±»å‹">11.3.3 åˆ¶ä½œopaqueç±»å‹</a></h4>
<p>pybind11ä¸¥é‡ä¾èµ–äºæ¨¡æ¿åŒ¹é…æœºåˆ¶æ¥è½¬æ¢STLç±»å‹çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œå¦‚vectorï¼Œé“¾è¡¨ï¼Œå“ˆå¸Œè¡¨ç­‰ã€‚ç”šè‡³ä¼šé€’å½’å¤„ç†ï¼Œå¦‚lists of hash maps of pairs of elementary and custom typesã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸€ä¸ªåŸºæœ¬é™åˆ¶å°±æ˜¯ï¼ŒPythonå’ŒC++ç±»å‹çš„è½¬æ¢æ¶‰åŠåˆ°æ‹·è´æ“ä½œï¼Œè¿™å¦¨ç¢äº†pass-by-referenceçš„è¯­ä¹‰ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ç»‘å®šå¦‚ä¸‹å‡½æ•°ï¼š</p>
<pre><code class="language-c++">void append_1(std::vector&lt;int&gt; &amp;v) {
   v.push_back(1);
}
</code></pre>
<p>åœ¨Pythonä¸­è°ƒç”¨å®ƒï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; v = [5, 6]
&gt;&gt;&gt; append_1(v)
&gt;&gt;&gt; print(v)
[5, 6]
</code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œé€šè¿‡å¼•ç”¨ä¼ é€’STLæ•°æ®æ—¶ï¼Œä¿®æ”¹å¹¶ä¸ä¼šä¼ é€’åˆ°Pythonä¾§ã€‚ç›¸åŒçš„åœºæ™¯è¡¨ç°åœ¨é€šè¿‡<code>def_readwrite</code>æˆ–<code>def_readonly</code>å‡½æ•°å…¬å¼€STLæ•°æ®ç»“æ„æ—¶ï¼š</p>
<pre><code class="language-c++">/* ... definition ... */

class MyClass {
    std::vector&lt;int&gt; contents;
};

/* ... binding code ... */

py::class_&lt;MyClass&gt;(m, &quot;MyClass&quot;)
    .def(py::init&lt;&gt;())
    .def_readwrite(&quot;contents&quot;, &amp;MyClass::contents);
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå±æ€§å¯ä»¥æ•´ä½“çš„è¯»å†™ã€‚ä½†æ˜¯ï¼Œæ¶‰åŠåˆ°appendæ“ä½œæ—¶å°±æ— èƒ½ä¸ºåŠ›äº†ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; m = MyClass()
&gt;&gt;&gt; m.contents = [5, 6]
&gt;&gt;&gt; print(m.contents)
[5, 6]
&gt;&gt;&gt; m.contents.append(7)
&gt;&gt;&gt; print(m.contents)
[5, 6]
</code></pre>
<p>æœ€åï¼Œåœ¨å¤„ç†å¤§å‹åˆ—è¡¨æ—¶ï¼Œæ¶‰åŠçš„æ‹·è´æ“ä½œä¼šè€—è´¹å·¨å¤§ã€‚ä¸ºå¤„ç†ä¸Šè¿°åœºæ™¯ï¼Œpybind11æä¾›äº†<code>PYBIND11_MAKE_OPAQUE(T)</code>æ¥ç¦ç”¨åŸºäºæ¨¡æ¿çš„ç±»å‹è½¬æ¢æœºåˆ¶ï¼Œä»è€Œä½¿ä»–ä»¬å˜å¾—ä¸é€æ˜ï¼ˆ<em>opaque</em>ï¼‰ã€‚opaqueå¯¹è±¡çš„å†…å®¹æ°¸è¿œä¸ä¼šè¢«æ£€æŸ¥æˆ–æå–ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥é€šè¿‡å¼•ç”¨ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œè¦å°†<code>std::vector&lt;int&gt;</code>è½¬æ¢ä¸ºopaqueç±»å‹ï¼Œéœ€è¦åœ¨æ‰€æœ‰ç»‘å®šä»£ç ä¹‹å‰æ·»åŠ å£°æ˜ï¼š</p>
<pre><code class="language-c++">PYBIND11_MAKE_OPAQUE(std::vector&lt;int&gt;);
</code></pre>
<p>è¿™ä¸ªå®å¿…é¡»åœ¨é¡¶å±‚ï¼ˆæ‰€æœ‰å‘½åç©ºé—´å¤–ï¼‰è®¾å®šï¼Œå› ä¸ºç„¶æ·»åŠ äº†<code>type_caster</code>çš„æ¨¡æ¿å®ä¾‹åŒ–ã€‚å¦‚æœä½ ç»‘å®šä»£ç åŒ…å«å¤šä¸ªç¼–è¯‘å•å…ƒï¼Œéœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶ä½¿ç”¨<code>std::vector&lt;int&gt;</code>å‰æŒ‡å®šï¼ˆé€šå¸¸é€šè¿‡å…¬å…±çš„å¤´æ–‡ä»¶æ¥å®ç°ï¼‰ã€‚opaqueå¯¹è±¡æœ‰ç›¸å…³çš„<code>class_</code>å®šä¹‰æ¥è”ç³»Pythonä¸­çš„ç±»åï¼Œè¿˜éœ€å®šä¹‰ä¸€ç»„æœ‰ç”¨çš„æ“ä½œï¼Œå¦‚ï¼š</p>
<pre><code class="language-c++">py::class_&lt;std::vector&lt;int&gt;&gt;(m, &quot;IntVector&quot;)
    .def(py::init&lt;&gt;())
    .def(&quot;clear&quot;, &amp;std::vector&lt;int&gt;::clear)
    .def(&quot;pop_back&quot;, &amp;std::vector&lt;int&gt;::pop_back)
    .def(&quot;__len__&quot;, [](const std::vector&lt;int&gt; &amp;v) { return v.size(); })
    .def(&quot;__iter__&quot;, [](std::vector&lt;int&gt; &amp;v) {
       return py::make_iterator(v.begin(), v.end());
    }, py::keep_alive&lt;0, 1&gt;()) /* Keep vector alive while iterator is used */
    // ....
</code></pre>
<h4 id="1134-ç»‘å®šstlå®¹å™¨"><a class="header" href="#1134-ç»‘å®šstlå®¹å™¨">11.3.4 ç»‘å®šSTLå®¹å™¨</a></h4>
<p>å…¬å¼€STLå®¹å™¨ä½œä¸ºä¸€ä¸ªPythonå¯¹è±¡æ—¶ä¸€ä¸ªç›¸å½“å¸¸è§çš„éœ€æ±‚ï¼Œå› æ­¤pybind11ä¹Ÿæä¾›äº†ä¸€ä¸ªå¯é€‰çš„å¤´æ–‡ä»¶<code>pybind11/stl_bind.h</code>æ¥åšè¿™ä»¶äº‹ã€‚æ˜ å°„å®¹å™¨ä¼šå°½å¯èƒ½çš„å»åŒ¹é…Pythonå¯¹åº”ç±»å‹çš„è¡Œä¸ºã€‚ä¸‹é¢ç¤ºä¾‹å°†å±•ç¤ºè¯¥æœºåˆ¶çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code class="language-c++">// Don't forget this
#include &lt;pybind11/stl_bind.h&gt;

PYBIND11_MAKE_OPAQUE(std::vector&lt;int&gt;);
PYBIND11_MAKE_OPAQUE(std::map&lt;std::string, double&gt;);

// ...

// later in binding code:
py::bind_vector&lt;std::vector&lt;int&gt;&gt;(m, &quot;VectorInt&quot;);
py::bind_map&lt;std::map&lt;std::string, double&gt;&gt;(m, &quot;MapStringDouble&quot;);
</code></pre>
<p>ç»‘å®šSTLå®¹å™¨æ—¶ï¼Œpybind11ä¼šæ ¹æ®å®¹å™¨å…ƒç´ çš„ç±»å‹æ¥å†³å®šè¯¥å®¹å™¨æ˜¯å¦åº”è¯¥å±€é™äºæ¨¡å—å†…ï¼ˆå‚è€ƒModule-local class bindingsç‰¹æ€§ï¼‰ã€‚å¦‚æœå®¹å™¨å…ƒç´ çš„ç±»å‹ä¸æ˜¯å·²ç»ç»‘å®šçš„è‡ªå®šä¹‰ç±»å‹ä¸”æœªæ ‡è¯†<code>py::module_local</code>ï¼Œé‚£ä¹ˆå®¹å™¨ç»‘å®šå°†åº”ç”¨<code>py::module_local</code>ã€‚è¿™åŒ…æ‹¬æ•°å€¼ç±»å‹ã€stringsã€Eigenç±»å‹ï¼Œå’Œå…¶ä»–åœ¨ç»‘å®šSTLå®¹å™¨æ—¶è¿˜æœªç»‘å®šçš„ç±»å‹ã€‚module-localç»‘å®šçš„æ„å›¾æ˜¯ä¸ºäº†é¿å…æ¨¡å—é—´çš„æ½œåœ¨çš„å†²çªï¼ˆå¦‚ï¼Œä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å—éƒ½è¯•å›¾ç»‘å®š<code>std::vector&lt;int&gt;</code>ï¼‰ã€‚</p>
<p>é€šè¿‡æŒ‡å®šå±æ€§<code>py::module_local()</code>æˆ–<code>py_module_local(false)</code>ï¼Œä½ ä¹Ÿå¯ä»¥å¼ºåˆ¶ç»‘å®šçš„STLå®¹å™¨å…¬å¼€åœ¨æ¨¡å—å†…æˆ–å…¨å±€ï¼š</p>
<pre><code class="language-c++">py::bind_vector&lt;std::vector&lt;int&gt;&gt;(m, &quot;VectorInt&quot;, py::module_local(false));
</code></pre>
<p>æ³¨æ„ï¼šè¿™æ ·çš„å…¨å±€ç»‘å®šå¯èƒ½ä¼šå¯¼è‡´æ¨¡å—æ— æ³•åŠ è½½ï¼Œå¦‚æœå…¶ä»–çš„æ¨¡å—ä¹Ÿç»‘å®šäº†ç›¸åŒçš„å®¹å™¨ç±»å‹ï¼ˆå¦‚<code>std::vector&lt;int&gt;</code>ï¼‰å¹¶ä»¥åŠ è½½ã€‚</p>
<h3 id="114-å‡½æ•°å¯¹è±¡"><a class="header" href="#114-å‡½æ•°å¯¹è±¡">11.4 å‡½æ•°å¯¹è±¡</a></h3>
<p>è¦ä½¿èƒ½ä»¥ä¸‹å±æ€§ï¼Œéœ€è¦åŒ…å«<code>pybind11/functional.h</code>ã€‚</p>
<p><strong>å›è°ƒå¹¶ä¼ é€’åŒ¿åå‡½æ•°</strong></p>
<p>C++11æ ‡å‡†å¼•å…¥äº†åŠŸèƒ½å¼ºå¤§çš„lambdaå‡½æ•°å’Œæ³›å‡½å¯¹è±¡<code>std::function&lt;&gt;</code>ã€‚lambdaå‡½æ•°æœ‰ä¸¤ç§ç±»å‹ï¼šæ— çŠ¶æ€lambdaå‡½æ•°ç±»ä¼¼äºæŒ‡å‘ä¸€å—åŒ¿åä»£ç çš„å‡½æ•°æŒ‡é’ˆï¼Œè€Œæœ‰çŠ¶æ€lambdaå‡½æ•°è¿˜ä¾èµ–äºå­˜å‚¨åœ¨lambdaé—­åŒ…å¯¹è±¡ä¸­çš„è¢«æ•è·çš„å‚æ•°ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ¥æ”¶ä»»æ„å‡½æ•°ç­¾åä¸º<code>int -&gt; int</code>çš„å‡½æ•°ç±»å‹å‚æ•°ï¼ˆæœ‰çŠ¶æ€æˆ–æ— çŠ¶æ€ï¼‰ï¼š</p>
<pre><code class="language-c++">int func_arg(const std::function&lt;int(int)&gt; &amp;f) {
    return f(10);
}
</code></pre>
<p>ä¸‹é¢çš„ä¾‹å­æ›´å¤æ‚ï¼Œå®ƒçš„å…¥å‚æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒæ ·ç±»å‹çš„å‡½æ•°å¯¹è±¡ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„lambdaå‡½æ•°ï¼Œå®ƒæ•è·äº†<code>f</code>å‚æ•°ï¼š</p>
<pre><code class="language-c++">std::function&lt;int(int)&gt; func_ret(const std::function&lt;int(int)&gt; &amp;f) {
    return [f](int i) {
        return f(i) + 1;
    };
}
</code></pre>
<p>åœ¨C++å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨pythonå…·åå‚æ•°ï¼Œéœ€è¦ä½¿ç”¨<code>py::cpp_function</code>åŒ…è£¹ï¼Œç±»ä¼¼äºä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="language-c++">py::cpp_function func_cpp() {
    return py::cpp_function([](int i) { return i+1; },
       py::arg(&quot;number&quot;));
}
</code></pre>
<p>åŒ…å«<code>pybind11/functional.h</code>å¤´æ–‡ä»¶åï¼Œå¯ä»¥ç®€å•åœ°ç›´æ¥ä¸ºä¸Šè¿°å‡½æ•°ç”Ÿæˆç»‘å®šä»£ç ï¼š</p>
<pre><code class="language-c++">#include &lt;pybind11/functional.h&gt;

PYBIND11_MODULE(example, m) {
    m.def(&quot;func_arg&quot;, &amp;func_arg);
    m.def(&quot;func_ret&quot;, &amp;func_ret);
    m.def(&quot;func_cpp&quot;, &amp;func_cpp);
}
</code></pre>
<p>Pythonä¸­äº¤äº’ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">$ python
&gt;&gt;&gt; import example
&gt;&gt;&gt; def square(i):
...     return i * i
...
&gt;&gt;&gt; example.func_arg(square)
100L
&gt;&gt;&gt; square_plus_1 = example.func_ret(square)
&gt;&gt;&gt; square_plus_1(4)
17L
&gt;&gt;&gt; plus_1 = func_cpp()
&gt;&gt;&gt; plus_1(number=43)
44L
</code></pre>
<blockquote>
<p>Warning</p>
<p>è¯·è®°ä½åœ¨ä»C++ä¼ é€’å‡½æ•°å¯¹è±¡åˆ°Pythonçš„è¿‡ç¨‹ä¸­ï¼ˆåå‘äº¦ç„¶ï¼‰ï¼Œå°†ç”Ÿæˆä¸€äº›åŒ…è£…ä»£ç æ¥ä¸¤ç§è¯­è¨€çš„å‡½æ•°è°ƒç”¨ã€‚è¿™ç§ç¿»è¯‘è‡ªç„¶ä¼šç¨å¾®å¢åŠ å‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚å½“ä¸€ä¸ªå‡½æ•°åœ¨Pythonå’ŒC++ä¹‹é—´æ¥å›æ‹·è´å¤šæ¬¡æ—¶ï¼ŒåŒ…è£…å±‚æ•°ä¼šä¸æ–­ç´¯ç§¯ï¼Œä¼šæ˜æ˜¾é™ä½æ€§èƒ½ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ªä¾‹å¤–ï¼šä¸€ä¸ªæ— çŠ¶æ€å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™åœ¨Pythonä¸­å…¬å¼€çš„å¦ä¸€ä¸ªC++å‡½æ•°æ—¶ï¼Œå°†ä¸ä¼šæœ‰é¢å¤–çš„å¼€é”€ã€‚Pybind11å°†ä»å°è£…çš„å‡½æ•°ä¸­æå–C++å‡½æ•°æŒ‡é’ˆï¼Œä»¥å›é¿æ½œåœ¨åœ°C++ -&gt; Python -&gt; C++çš„å¾€è¿”ã€‚</p>
</blockquote>
<h3 id="115-chrono"><a class="header" href="#115-chrono">11.5 Chrono</a></h3>
<p>åŒ…å«<code>pybind11/chrono</code>å°†ä½¿èƒ½C++11 chronoå’ŒPython datatimeå¯¹è±¡å°†çš„è‡ªåŠ¨è½¬æ¢ï¼Œè¿˜æ”¯æŒpython floatsï¼ˆä»<code>time.monotonic()</code>æˆ–<code>time.perf_counter()</code>è·å–çš„ï¼‰å’Œ<code>time.process_time()</code>åˆ°durationsçš„è½¬æ¢ã€‚</p>
<h4 id="1151-c11æ—¶é’Ÿçš„æ¦‚è§ˆ"><a class="header" href="#1151-c11æ—¶é’Ÿçš„æ¦‚è§ˆ">11.5.1 C++11æ—¶é’Ÿçš„æ¦‚è§ˆ</a></h4>
<p>ä½¿ç”¨è¿™äº›è½¬æ¢æ—¶å®¹æ˜“æ··æ·†çš„ç‚¹æ˜¯ï¼ŒC++11ä¸­æä¾›çš„å„ç§æ—¶é’Ÿçš„å·®å¼‚ã€‚C++11æ ‡å‡†å®šä¹‰äº†ä¸‰ç§æ—¶é’Ÿç±»å‹ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚å®šä¹‰è‡ªå·±çš„æ—¶é’Ÿç±»å‹ã€‚è¿™äº›æ—¶é’Ÿæœ‰ç€ä¸ç”¨çš„å±æ€§ï¼Œä¸Pythonä¹‹é—´è½¬æ¢æ—¶ä¹Ÿä¼šè·å¾—ä¸åŒçš„ç»“æœã€‚</p>
<p>æ ‡å‡†å®šä¹‰çš„ç¬¬ä¸€ç§æ—¶é’Ÿ<code>std::chrono::system_clock</code>ã€‚å®ƒæµ‹é‡å½“å‰çš„æ—¶é—´å’Œæ—¥æœŸã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶é’Ÿä¼šéšç€æ“ä½œç³»ç»Ÿçš„æ—¶é’Ÿå˜åŒ–è€Œæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œåœ¨ç³»ç»Ÿæ—¶é—´ä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥æ—¶ï¼Œè¿™ä¸ªæ—¶é’Ÿä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚è¿™å¯¹è®¡æ—¶åŠŸèƒ½æ¥è¯´å¾ˆç³Ÿç³•ï¼Œä½†å¯¹æµ‹é‡wall timeè¿˜æ˜¯æœ‰ç”¨çš„ã€‚</p>
<p>æ ‡å‡†å®šä¹‰çš„ç¬¬äºŒç§æ—¶é’Ÿ<code>std::chrono::steady_clock</code>ã€‚è¿™ä¸ªæ—¶é’Ÿä»¥ç¨³å®šçš„é€Ÿåº¦è·³åŠ¨ï¼Œä»ä¸è°ƒæ•´ã€‚è¿™éå¸¸å®ç”¨äºè®¡æ—¶åŠŸèƒ½ï¼Œä½†ä¸å®é™…æ—¶é—´å’Œæ—¥å¿—å¹¶ä¸ä¸€è‡´ã€‚è¿™ä¸ªæ—¶é—´é€šå¸¸æ˜¯ä½ æ“ä½œç³»ç»Ÿå·²ç»è¿è¡Œçš„æ—¶é—´ï¼Œè™½ç„¶ä¸æ˜¯å¿…é¡»çš„ã€‚è¿™ä¸ªæ—¶é’Ÿæ°¸è¿œä¸ä¼šä¸ç³»ç»Ÿæ—¶é’Ÿç›¸åŒï¼Œå› ä¸ºç³»ç»Ÿæ—¶é’Ÿå¯ä»¥æ”¹å˜ï¼Œä½†steady_clockä¸èƒ½ã€‚</p>
<p>æ ‡å‡†å®šä¹‰çš„ç¬¬äºŒç§æ—¶é’Ÿ<code>std::chrono::high_resolution_clock</code>ã€‚å®ƒæ˜¯ç³»ç»Ÿä¸­åˆ†è¾¨ç‡æœ€é«˜çš„æ—¶é’Ÿï¼Œé€šå¸¸æ˜¯system clock æˆ– steady clockçš„ä¸€ç§ï¼Œä¹Ÿå¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ—¶é’Ÿã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åœ¨Pythonä¸­è·å–åˆ°çš„è¯¥æ—¶é’Ÿçš„è½¬æ¢å€¼ï¼Œå¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œè¿™å–å†³äºç³»ç»Ÿçš„å®ç°ã€‚å¦‚æœå®ƒæ˜¯ç³»ç»Ÿæ—¶é’Ÿçš„ä¸€ç§ï¼ŒPythonå°†å¾—åˆ°datetimeå¯¹è±¡ï¼Œå¦åˆ™å°†å¾—åˆ°timedeltaå¯¹è±¡ã€‚</p>
<h4 id="1152-æä¾›çš„è½¬æ¢"><a class="header" href="#1152-æä¾›çš„è½¬æ¢">11.5.2 æä¾›çš„è½¬æ¢</a></h4>
<p><strong>C++åˆ°Python</strong></p>
<ul>
<li><code>std::chrono::system_clock::time_point</code> â†’ <code>datetime.datetime</code></li>
<li><code>std::chrono::duration</code> â†’ <code>datetime.timedelta</code></li>
<li><code>std::chrono::[other_clocks]::time_point</code> â†’ <code>datetime.timedelta</code></li>
</ul>
<p><strong>Pythonåˆ°C++</strong></p>
<ul>
<li><code>datetime.datetime</code>or<code>datetime.date</code>or<code>datetime.time</code> â†’ <code>std::chrono::system_clock::time_point</code></li>
<li><code>datetime.timedelta</code> â†’ <code>std::chrono::duration</code></li>
<li><code>datetime.timedelta</code> â†’ <code>std::chrono::[other_clocks]::time_point</code></li>
<li><code>float</code> â†’ <code>std::chrono::duration</code></li>
<li><code>float</code> â†’ <code>std::chrono::[other_clocks]::time_point</code></li>
</ul>
<h3 id="116-eigen"><a class="header" href="#116-eigen">11.6 Eigen</a></h3>
<p>æ²¡æ¥è§¦è¿‡Eigenï¼Œå…ˆä¸ç¿»è¯‘ã€‚</p>
<h3 id="117-è‡ªå®šä¹‰ç±»å‹è½¬æ¢"><a class="header" href="#117-è‡ªå®šä¹‰ç±»å‹è½¬æ¢">11.7 è‡ªå®šä¹‰ç±»å‹è½¬æ¢</a></h3>
<p>åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œç¨‹åºå¯èƒ½éœ€è¦ä¸€äº›pybind11æ²¡æœ‰æä¾›çš„è‡ªå®šä¹‰ç±»å‹è½¬æ¢ï¼Œè¿™éœ€è¦ä½¿ç”¨åˆ°åŸå§‹çš„Python C APIã€‚è¿™æ˜¯ç›¸å½“é«˜çº§çš„ä½¿ç”¨æ–¹æ³•ï¼Œåªæœ‰ç†Ÿæ‚‰Pythonå¼•ç”¨è®¡æ•°å¤æ‚ä¹‹å¤„çš„ä¸“å®¶æ‰èƒ½ä½¿ç”¨ã€‚</p>
<p>The following snippets demonstrate how this works for a very simple <code>inty</code> type that that should be convertible from Python types that provide a <code>__int__(self)</code> method.</p>
<pre><code class="language-c++">struct inty { long long_value; };

void print(inty s) {
    std::cout &lt;&lt; s.long_value &lt;&lt; std::endl;
}
</code></pre>
<p>The following Python snippet demonstrates the intended usage from the Python side:</p>
<pre><code class="language-python">class A:
    def __int__(self):
        return 123


from example import print

print(A())
</code></pre>
<p>To register the necessary conversion routines, it is necessary to add an instantiation of the <code>pybind11::detail::type_caster&lt;T&gt;</code> template. Although this is an implementation detail, adding an instantiation of this type is explicitly allowed.</p>
<pre><code class="language-c++">namespace pybind11 { namespace detail {
    template &lt;&gt; struct type_caster&lt;inty&gt; {
    public:
        /**
         * This macro establishes the name 'inty' in
         * function signatures and declares a local variable
         * 'value' of type inty
         */
        PYBIND11_TYPE_CASTER(inty, _(&quot;inty&quot;));

        /**
         * Conversion part 1 (Python-&gt;C++): convert a PyObject into a inty
         * instance or return false upon failure. The second argument
         * indicates whether implicit conversions should be applied.
         */
        bool load(handle src, bool) {
            /* Extract PyObject from handle */
            PyObject *source = src.ptr();
            /* Try converting into a Python integer value */
            PyObject *tmp = PyNumber_Long(source);
            if (!tmp)
                return false;
            /* Now try to convert into a C++ int */
            value.long_value = PyLong_AsLong(tmp);
            Py_DECREF(tmp);
            /* Ensure return code was OK (to avoid out-of-range errors etc) */
            return !(value.long_value == -1 &amp;&amp; !PyErr_Occurred());
        }

        /**
         * Conversion part 2 (C++ -&gt; Python): convert an inty instance into
         * a Python object. The second and third arguments are used to
         * indicate the return value policy and parent object (for
         * ``return_value_policy::reference_internal``) and are generally
         * ignored by implicit casters.
         */
        static handle cast(inty src, return_value_policy /* policy */, handle /* parent */) {
            return PyLong_FromLong(src.long_value);
        }
    };
}} // namespace pybind11::detail
</code></pre>
<blockquote>
<p>Note: A <code>type_caster&lt;T&gt;</code> defined with <code>PYBIND11_TYPE_CASTER(T, ...)</code> requires that <code>T</code> is default-constructible (<code>value</code> is first default constructed and then <code>load()</code> assigns to it).</p>
</blockquote>
<blockquote>
<p>Warning: When using custom type casters, itâ€™s important to declare them consistently in every compilation unit of the Python extension module. Otherwise, undefined behavior can ensue.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="10.æ™ºèƒ½æŒ‡é’ˆ.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="12.Pythonçš„C++æ¥å£.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="10.æ™ºèƒ½æŒ‡é’ˆ.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="12.Pythonçš„C++æ¥å£.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
